# üîß Services Reference

## –û–±–∑–æ—Ä —Å–µ—Ä–≤–∏—Å–æ–≤

–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π –≤—ã–¥–µ–ª–µ–Ω –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–Ω–µ–µ –Ω–∞—Ö–æ–¥–∏–ª–∞—Å—å –≤ ViewSets –∏ Serializers.

## HashtagService

**–§–∞–π–ª:** `books/services/hashtag_service.py`

–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ö—ç—à—Ç–µ–≥–∞–º–∏ –∫–Ω–∏–≥.

### –ú–µ—Ç–æ–¥—ã

#### `normalize_name(name: str) -> str`
–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ö—ç—à—Ç–µ–≥–∞:
- –£–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
- –£–±–∏—Ä–∞–µ—Ç `#` –≤ –Ω–∞—á–∞–ª–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä:**
```python
HashtagService.normalize_name("  #—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞  ")  # ‚Üí "—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"
HashtagService.normalize_name("—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞")  # ‚Üí "—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"
```

#### `create_slug(name: str) -> str`
–°–æ–∑–¥–∞–µ—Ç slug –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è —Ö—ç—à—Ç–µ–≥–∞ –¥–ª—è URL.

#### `get_or_create_hashtag(name: str, creator: User) -> tuple[Hashtag, bool]`
–°–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç —Ö—ç—à—Ç–µ–≥. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `(hashtag, created)`.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `name` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —Ö—ç—à—Ç–µ–≥–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å `#` –∏–ª–∏ –±–µ–∑)
- `creator` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Å–æ–∑–¥–∞—Ç–µ–ª—å

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `(Hashtag, bool)` ‚Äî —Ö—ç—à—Ç–µ–≥ –∏ —Ñ–ª–∞–≥ —Å–æ–∑–¥–∞–Ω–∏—è

#### `add_hashtags_to_book(book: Book, hashtag_names: List[str], creator: User) -> List[Hashtag]`
–î–æ–±–∞–≤–ª—è–µ—Ç —Ö—ç—à—Ç–µ–≥–∏ –∫ –∫–Ω–∏–≥–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ª–∏–º–∏—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `book` ‚Äî –∫–Ω–∏–≥–∞
- `hashtag_names` ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π —Ö—ç—à—Ç–µ–≥–æ–≤
- `creator` ‚Äî —Å–æ–∑–¥–∞—Ç–µ–ª—å —Ö—ç—à—Ç–µ–≥–æ–≤

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ö—ç—à—Ç–µ–≥–æ–≤

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `HashtagLimitExceeded` ‚Äî –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç (20 —Ö—ç—à—Ç–µ–≥–æ–≤ –Ω–∞ –∫–Ω–∏–≥—É)

---

## TransferService

**–§–∞–π–ª:** `books/services/transfer_service.py`

–°–µ—Ä–≤–∏—Å –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–Ω–∏–≥ –º–µ–∂–¥—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

### –ú–µ—Ç–æ–¥—ã

#### `transfer_to_library(book: Book, library: Library) -> Book`
–ü–µ—Ä–µ–¥–∞–µ—Ç –∫–Ω–∏–≥—É –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É (–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ `library`, `owner` –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º).

#### `transfer_to_user(book: Book, new_owner: User) -> Book`
–ü–µ—Ä–µ–¥–∞–µ—Ç –∫–Ω–∏–≥—É –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–º–µ–Ω—è–µ—Ç `owner`).

#### `transfer_book(book: Book, library_id: int = None, user_id: int = None) -> tuple[Book, str]`
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–¥–∞—á–∏ –∫–Ω–∏–≥–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `book` ‚Äî –∫–Ω–∏–≥–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏
- `library_id` ‚Äî ID –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `user_id` ‚Äî ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `(Book, str)` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–Ω–∏–≥–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `TransferError` ‚Äî –µ—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –Ω–∏ –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä

---

## BookService

**–§–∞–π–ª:** `books/services/book_service.py`

–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–≥–∞–º–∏ –∏ –∏—Ö —Å–≤—è–∑—è–º–∏.

### –ú–µ—Ç–æ–¥—ã

#### `create_book_with_relations(validated_data: dict, author_ids: List[int], hashtag_names: Optional[List[str]], creator: User) -> Book`
–°–æ–∑–¥–∞–µ—Ç –∫–Ω–∏–≥—É —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏ (–∞–≤—Ç–æ—Ä—ã, —Ö—ç—à—Ç–µ–≥–∏).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `validated_data` ‚Äî –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏
- `author_ids` ‚Äî —Å–ø–∏—Å–æ–∫ ID –∞–≤—Ç–æ—Ä–æ–≤ (–¥–æ 3-—Ö)
- `hashtag_names` ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π —Ö—ç—à—Ç–µ–≥–æ–≤ (–¥–æ 20, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `creator` ‚Äî —Å–æ–∑–¥–∞—Ç–µ–ª—å –∫–Ω–∏–≥–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ `owner`)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–æ–∑–¥–∞–Ω–Ω—É—é –∫–Ω–∏–≥—É —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏

#### `update_book_authors(book: Book, author_ids: Optional[List[int]]) -> None`
–û–±–Ω–æ–≤–ª—è–µ—Ç –∞–≤—Ç–æ—Ä–æ–≤ –∫–Ω–∏–≥–∏ (—É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ —Å–≤—è–∑–∏, —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ).

#### `process_normalized_pages(book: Book, normalized_image_urls: List[str]) -> None`
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Å–æ–∑–¥–∞–µ—Ç BookPage –∑–∞–ø–∏—Å–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `book` ‚Äî —Å–æ–∑–¥–∞–Ω–Ω–∞—è –∫–Ω–∏–≥–∞
- `normalized_image_urls` ‚Äî —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –∫ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `["/media/temp/normalized/normalized_uuid1.jpg", ...]`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ `media/temp/normalized/` –≤ `media/books/pages/processed/`
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ `BookPage` –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (width, height, processing_status='completed')
- –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—à–∏—Ä–∏–Ω–∞/–≤—ã—Å–æ—Ç–∞) —Å –ø–æ–º–æ—â—å—é PIL
- –£–¥–∞–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**
```python
# –í BookCreateSerializer.create()
if normalized_image_urls:
    BookService.process_normalized_pages(book, normalized_image_urls)
```

---

## document_processor

**–§–∞–π–ª:** `books/services/document_processor.py`

–°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã.

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è
- **OpenCV** ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ú–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ (Canny, Sobel, Laplacian, –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è)
  - –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (four_point_transform)
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –∫–∞—á–µ—Å—Ç–≤–æ–º JPEG 90%
  - Fallback –¥–ª—è –±–µ–ª—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –±–µ–ª–æ–º —Ñ–æ–Ω–µ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

### –§—É–Ω–∫—Ü–∏–∏

#### `process_document(input_path, output_path) -> tuple[int, int]`
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç: –Ω–∞—Ö–æ–¥–∏—Ç –≥—Ä–∞–Ω–∏—Ü—ã, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `input_path` ‚Äî –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
- `output_path` ‚Äî –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `(width, height)` ‚Äî —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `ValueError` ‚Äî –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç

#### `normalize_pages_batch(files: List[File]) -> List[Dict]`
–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.

---

## LLMService

**–§–∞–π–ª:** `books/services/llm_service.py`

–°–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∏ —á–µ—Ä–µ–∑ OpenAI GPT-4o.

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è
- **API:** OpenAI GPT-4o (ChatGPT-4o)
- **–ú–æ–¥–µ–ª—å:** `gpt-4o`
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:** –°—Ç—Ä–æ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
  - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü (base64 –∏–ª–∏ URLs)
  - JSON —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–µ—Ç–æ–¥—ã

#### `auto_fill_book_data(image_urls: List[str], categories_json: dict) -> dict`
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ OpenAI GPT-4o –∏ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–Ω–∏–≥–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `image_urls` ‚Äî —Å–ø–∏—Å–æ–∫ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å—Ç—Ä–∞–Ω–∏—Ü –∫–Ω–∏–≥–∏
- `categories_json` ‚Äî JSON —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–Ω–∏–≥–∏ (title, authors, publisher, category_id –∏ —Ç.–¥.)

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `openai` Python –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞: 60 —Å–µ–∫—É–Ω–¥
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: retry —Å exponential backoff (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤: 8000 –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –∫–Ω–∏–≥–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –¥–ª—è LLM

#### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
```json
{
  "categories": [
    {
      "id": 1,
      "name": "–ê–∑–∏—è",
      "subcategories": [
        {"id": 2, "name": "–ò–Ω–¥–∏—è, –ü–∞–∫–∏—Å—Ç–∞–Ω, –¢–∏–±–µ—Ç, –¶–µ–π–ª–æ–Ω (–®—Ä–∏-–õ–∞–Ω–∫–∞)"}
      ]
    }
  ]
}
```

#### –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç LLM
```json
{
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏",
  "subtitle": "–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)",
  "category_id": 1,
  "authors": ["–§–∞–º–∏–ª–∏—è –ò–º—è", "–§–∞–º–∏–ª–∏—è –ò–º—è"],
  "publisher_name": "–ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞",
  "publication_place": "–ì–æ—Ä–æ–¥",
  "year": 2023,
  "year_approx": "",
  "pages_info": "300 —Å—Ç—Ä., –∏–ª.",
  "circulation": 5000,
  "language_name": "–†—É—Å—Å–∫–∏–π",
  "binding_type": "hard",
  "binding_details": "–¢–≤–µ—Ä–¥—ã–π –ø–µ—Ä–µ–ø–ª–µ—Ç, –∫—Ä–∞—Å–Ω—ã–π",
  "format": "regular",
  "condition": "excellent",
  "condition_details": "",
  "price_rub": "1500.00",
  "seller_code": "",
  "isbn": "978-5-123456-78-9",
  "description": "–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –∫–Ω–∏–≥–∏"
}
```

**–ü–æ–ª—è, –ù–ï –≤–∫–ª—é—á–∞–µ–º—ã–µ –≤ –æ—Ç–≤–µ—Ç LLM:**
- `owner` ‚Äî –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- `library` ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ —Ñ–æ—Ä–º–µ
- `status` ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ —Ñ–æ—Ä–º–µ
- `hashtags` ‚Äî –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ —Ñ–æ—Ä–º–µ
- `reading_dates` ‚Äî –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ —Ñ–æ—Ä–º–µ
- `created_at`, `updated_at` ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è
- `electronic_versions`, `pages`, `reviews` ‚Äî —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

### –ü—Ä–æ–º–ø—Ç –¥–ª—è LLM

–ü—Ä–æ–º–ø—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –≤–∫–ª—é—á–∞–µ—Ç:
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å—Ç—Ä–∞–Ω–∏—Ü –∫–Ω–∏–≥–∏
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å ID
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–æ—Ä–º–∞—Ç—É –æ—Ç–≤–µ—Ç–∞ (JSON)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π (binding_type, format, condition –∏ —Ç.–¥.)

**–î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –≤—ã–±–æ—Ä—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:**
1. –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–º–∞—Ç–∏–∫–∏
2. –í—ã–±–æ—Ä –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

---

### –í ViewSets

```python
from .services.hashtag_service import HashtagService
from .services.transfer_service import TransferService

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö—ç—à—Ç–µ–≥–æ–≤
added_hashtags = HashtagService.add_hashtags_to_book(
    book, hashtag_names, request.user
)

# –ü–µ—Ä–µ–¥–∞—á–∞ –∫–Ω–∏–≥–∏
book, message = TransferService.transfer_book(
    book, library_id=library_id, user_id=user_id
)
```

### –í Serializers

```python
from .services.book_service import BookService

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ —Å–æ —Å–≤—è–∑—è–º–∏
book = BookService.create_book_with_relations(
    validated_data, author_ids, hashtag_names, creator
)
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-27

